<!doctype html>
<html lang="ko">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>전세 vs 월세(임대인) 비교 계산기</title>
        <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin />
        <link
            href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/variable/pretendardvariable-dynamic-subset.min.css"
            rel="stylesheet"
        />
        <style>
            :root {
                --bg: #0a1210;
                --card: rgba(12, 24, 20, 0.9);
                --card-inner: rgba(16, 32, 26, 0.7);
                --muted: #7a9e8f;
                --text: #e4f0ea;
                --accent: #2dd4a0;
                --accent-soft: rgba(45, 212, 160, 0.12);
                --accent-dark: #1a7a5c;
                --border: rgba(255, 255, 255, 0.06);
                --border-light: rgba(255, 255, 255, 0.1);
                --good: #34d399;
                --good-bg: rgba(52, 211, 153, 0.12);
                --bad: #f87171;
                --bad-bg: rgba(248, 113, 113, 0.1);
                --shadow: 0 20px 50px rgba(0, 0, 0, 0.6);
                --shadow-sm: 0 4px 20px rgba(0, 0, 0, 0.4);
                --radius: 20px;
                --radius-sm: 14px;
            }
            * {
                box-sizing: border-box;
            }
            html {
                scroll-behavior: smooth;
            }
            body {
                margin: 0;
                font-family:
                    "Pretendard Variable",
                    Pretendard,
                    -apple-system,
                    BlinkMacSystemFont,
                    "Apple SD Gothic Neo",
                    sans-serif;
                background: var(--bg);
                color: var(--text);
                min-height: 100vh;
                position: relative;
                overflow-x: hidden;
            }
            body::before {
                content: "";
                position: fixed;
                inset: 0;
                background:
                    radial-gradient(
                        ellipse 900px 500px at 10% 0%,
                        rgba(45, 212, 160, 0.12),
                        transparent 60%
                    ),
                    radial-gradient(
                        ellipse 700px 400px at 90% 10%,
                        rgba(26, 122, 92, 0.15),
                        transparent 50%
                    ),
                    radial-gradient(
                        ellipse 600px 600px at 50% 100%,
                        rgba(45, 212, 160, 0.06),
                        transparent 60%
                    );
                pointer-events: none;
                z-index: 0;
            }
            .container {
                position: relative;
                z-index: 1;
                max-width: 1320px;
                margin: 0 auto;
                padding: 48px 24px 80px;
            }
            header {
                display: flex;
                align-items: flex-end;
                justify-content: space-between;
                gap: 20px;
                margin-bottom: 28px;
            }
            h1 {
                margin: 0;
                font-size: clamp(22px, 4vw, 28px);
                font-weight: 700;
                letter-spacing: -0.5px;
                background: linear-gradient(
                    135deg,
                    var(--text) 0%,
                    var(--accent) 100%
                );
                -webkit-background-clip: text;
                -webkit-text-fill-color: transparent;
                background-clip: text;
            }
            .subtitle {
                margin: 10px 0 0;
                color: var(--muted);
                font-size: 13.5px;
                line-height: 1.7;
                font-weight: 400;
                max-width: 560px;
            }
            .subtitle b {
                color: var(--text);
                font-weight: 500;
            }
            .pill {
                border: 1px solid var(--border-light);
                padding: 10px 16px;
                border-radius: 999px;
                color: var(--muted);
                font-size: 12px;
                white-space: nowrap;
                background: rgba(45, 212, 160, 0.05);
                backdrop-filter: blur(10px);
                font-weight: 450;
                letter-spacing: -0.2px;
            }
            .grid {
                display: grid;
                grid-template-columns: 1.05fr 0.95fr;
                gap: 20px;
            }
            @media (max-width: 1024px) {
                .grid {
                    grid-template-columns: 1fr;
                }
                header {
                    align-items: flex-start;
                    flex-direction: column;
                }
                .pill {
                    white-space: normal;
                    line-height: 1.5;
                }
            }
            .card {
                background: var(--card);
                border: 1px solid var(--border);
                border-radius: var(--radius);
                box-shadow: var(--shadow);
                backdrop-filter: blur(20px);
                overflow: hidden;
            }
            .card .inner {
                padding: 24px;
            }
            .card h2 {
                margin: 0 0 16px;
                font-size: 15px;
                font-weight: 600;
                letter-spacing: -0.2px;
                color: var(--muted);
                text-transform: uppercase;
                display: flex;
                align-items: center;
                gap: 8px;
            }
            .card h2::before {
                content: "";
                width: 3px;
                height: 14px;
                background: var(--accent);
                border-radius: 2px;
            }

            .form {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 14px;
            }
            @media (max-width: 600px) {
                .form {
                    grid-template-columns: 1fr;
                }
            }

            label {
                display: flex;
                flex-direction: column;
                gap: 8px;
                font-size: 12.5px;
                font-weight: 500;
                color: var(--muted);
                letter-spacing: -0.1px;
            }
            .input {
                display: flex;
                align-items: center;
                gap: 10px;
                background: rgba(0, 0, 0, 0.3);
                border: 1px solid var(--border);
                border-radius: var(--radius-sm);
                padding: 12px 14px;
                transition: all 0.2s ease;
            }
            .input:focus-within {
                border-color: var(--accent);
                box-shadow: 0 0 0 3px var(--accent-soft);
            }
            .input input {
                width: 100%;
                min-width: 0;
                border: 0;
                outline: none;
                background: transparent;
                color: var(--text);
                font-size: 15px;
                font-family: inherit;
                font-weight: 500;
                font-variant-numeric: tabular-nums;
            }
            .input input::placeholder {
                color: rgba(122, 158, 143, 0.5);
                font-weight: 400;
            }
            .suffix {
                color: var(--muted);
                font-size: 11.5px;
                font-weight: 500;
                padding-left: 10px;
                border-left: 1px solid var(--border);
                white-space: nowrap;
                flex-shrink: 0;
            }
            .actions {
                margin-top: 16px;
                display: flex;
                gap: 10px;
                flex-wrap: wrap;
            }
            button {
                border: 1px solid var(--border-light);
                background: rgba(45, 212, 160, 0.08);
                color: var(--text);
                padding: 11px 16px;
                border-radius: 12px;
                cursor: pointer;
                font-size: 13px;
                font-family: inherit;
                font-weight: 500;
                transition: all 0.2s ease;
            }
            button:hover {
                background: rgba(45, 212, 160, 0.15);
                border-color: var(--accent);
                transform: translateY(-1px);
            }
            button:active {
                transform: translateY(0);
            }
            .note {
                margin-top: 16px;
                padding: 14px 16px;
                border-radius: var(--radius-sm);
                border: 1px dashed rgba(45, 212, 160, 0.3);
                color: var(--muted);
                font-size: 12px;
                line-height: 1.6;
                background: var(--accent-soft);
            }
            .note b {
                color: var(--text);
                font-weight: 600;
            }

            .results {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 16px;
            }
            @media (max-width: 1024px) {
                .results {
                    grid-template-columns: 1fr 1fr;
                }
            }
            @media (max-width: 700px) {
                .results {
                    grid-template-columns: 1fr;
                }
            }

            .result-card {
                background: var(--card-inner);
                border: 1px solid var(--border);
                border-radius: 18px;
                overflow: hidden;
            }
            .result-card .inner {
                padding: 18px;
            }
            .optionTitle {
                display: flex;
                align-items: center;
                justify-content: space-between;
                gap: 10px;
                margin-bottom: 14px;
                padding-bottom: 14px;
                border-bottom: 1px solid var(--border);
            }
            .optionTitle .title {
                font-size: 16px;
                font-weight: 700;
                letter-spacing: -0.3px;
            }
            .optionTitle .desc {
                font-size: 11px;
                color: var(--muted);
                margin-top: 3px;
                font-weight: 450;
            }
            .badge {
                font-size: 11px;
                font-weight: 600;
                padding: 6px 12px;
                border-radius: 999px;
                border: 1px solid var(--border);
                color: var(--muted);
                background: rgba(255, 255, 255, 0.03);
                white-space: nowrap;
            }
            .rows {
                display: flex;
                flex-direction: column;
                gap: 6px;
            }

            .row {
                display: flex;
                align-items: center;
                justify-content: space-between;
                gap: 8px;
                padding: 10px 12px;
                border-radius: 12px;
                background: rgba(0, 0, 0, 0.25);
                border: 1px solid rgba(255, 255, 255, 0.03);
            }
            .row .k {
                color: var(--muted);
                font-size: 11.5px;
                font-weight: 450;
                flex-shrink: 0;
            }
            .row .v {
                font-size: clamp(12px, 2.5vw, 13px);
                font-weight: 600;
                font-variant-numeric: tabular-nums;
                letter-spacing: -0.2px;
                text-align: right;
                word-break: keep-all;
                min-width: 0;
            }

            .net {
                margin-top: 12px;
                padding: 14px;
                border-radius: 14px;
                border: 1px solid rgba(45, 212, 160, 0.15);
                background: rgba(45, 212, 160, 0.05);
                display: flex;
                flex-direction: column;
                gap: 8px;
            }
            .net .k {
                color: var(--muted);
                font-size: 11.5px;
                font-weight: 450;
                line-height: 1.4;
            }
            .net .v {
                font-size: clamp(18px, 4vw, 22px);
                font-weight: 700;
                letter-spacing: -0.5px;
                font-variant-numeric: tabular-nums;
                line-height: 1;
            }
            .good {
                color: var(--good);
            }
            .bad {
                color: var(--bad);
            }

            .summary {
                margin-top: 18px;
                padding: 18px;
                border-radius: 16px;
                border: 1px solid var(--border-light);
                background: rgba(0, 0, 0, 0.25);
                line-height: 1.7;
                color: var(--text);
                font-size: 13px;
            }
            .summary b {
                font-weight: 600;
            }
            .summary .muted {
                color: var(--muted);
                font-size: 12px;
            }
            footer {
                margin-top: 18px;
                color: var(--muted);
                font-size: 11.5px;
                line-height: 1.7;
                opacity: 0.8;
            }
            .tiny {
                font-size: 10.5px;
                color: rgba(122, 158, 143, 0.8);
            }

            /* Smooth number transitions */
            .v {
                transition: color 0.3s ease;
            }

            /* Scrollbar styling */
            ::-webkit-scrollbar {
                width: 8px;
                height: 8px;
            }
            ::-webkit-scrollbar-track {
                background: transparent;
            }
            ::-webkit-scrollbar-thumb {
                background: rgba(45, 212, 160, 0.2);
                border-radius: 4px;
            }
            ::-webkit-scrollbar-thumb:hover {
                background: rgba(45, 212, 160, 0.35);
            }
        </style>
    </head>
    <body>
        <div class="container">
            <header>
                <div>
                    <h1>전세 vs 월세 비교 계산기</h1>
                    <p class="subtitle">
                        임대인 관점에서 전세금/보증금을 받으면
                        <b>대출 먼저 상환 → 남는 금액 예금 운용</b>을 가정하고,
                        월세는 <b>월세 수입(+)</b>으로 반영해
                        <b>월 순현금흐름</b>을 비교합니다. 예금이자에는
                        이자소득세 15.4%(원천징수)를 적용합니다.
                    </p>
                </div>
                <div class="pill">금리: 연(%) · 이자: 월 환산 · 자동 저장</div>
            </header>

            <div class="grid">
                <section class="card">
                    <div class="inner">
                        <h2>입력</h2>
                        <div class="form">
                            <label>
                                전세금 (받는 금액)
                                <div class="input">
                                    <input
                                        id="jeonseDeposit"
                                        type="text"
                                        inputmode="numeric"
                                        placeholder="예: 500,000,000"
                                    />
                                    <div class="suffix">원</div>
                                </div>
                            </label>

                            <label>
                                월세 보증금 (받는 금액)
                                <div class="input">
                                    <input
                                        id="wolseDeposit"
                                        type="text"
                                        inputmode="numeric"
                                        placeholder="예: 50,000,000"
                                    />
                                    <div class="suffix">원</div>
                                </div>
                            </label>

                            <label>
                                월세 (받는 금액)
                                <div class="input">
                                    <input
                                        id="wolseRent"
                                        type="text"
                                        inputmode="numeric"
                                        placeholder="예: 1,500,000"
                                    />
                                    <div class="suffix">원/월</div>
                                </div>
                            </label>

                            <label>
                                대출금 (잔액)
                                <div class="input">
                                    <input
                                        id="loanAmount"
                                        type="text"
                                        inputmode="numeric"
                                        placeholder="예: 200,000,000"
                                    />
                                    <div class="suffix">원</div>
                                </div>
                            </label>

                            <label>
                                대출금리
                                <div class="input">
                                    <input
                                        id="loanRate"
                                        type="number"
                                        step="0.01"
                                        placeholder="예: 4.2"
                                    />
                                    <div class="suffix">%/년</div>
                                </div>
                            </label>

                            <label>
                                예금금리
                                <div class="input">
                                    <input
                                        id="depositRate"
                                        type="number"
                                        step="0.01"
                                        placeholder="예: 3.2"
                                    />
                                    <div class="suffix">%/년</div>
                                </div>
                            </label>
                        </div>

                        <div class="actions">
                            <button id="btnExample" type="button">
                                예시값 채우기
                            </button>
                            <button id="btnReset" type="button">초기화</button>
                        </div>

                        <div class="note">
                            <b>이자소득세 안내</b><br />
                            예금이자에는 <b>15.4%</b> 이자소득세(원천징수 14% +
                            지방소득세 1.4%)가 자동 적용됩니다.
                        </div>
                    </div>
                </section>

                <section class="card">
                    <div class="inner">
                        <h2>결과</h2>

                        <div class="results">
                            <div class="result-card">
                                <div class="inner">
                                    <div class="optionTitle">
                                        <div>
                                            <div class="title">전세</div>
                                            <div class="desc">
                                                월세 수입 0원
                                            </div>
                                        </div>
                                        <div class="badge" id="badgeJeonse">
                                            —
                                        </div>
                                    </div>

                                    <div class="rows">
                                        <div class="row">
                                            <div class="k">대출 상환액</div>
                                            <div class="v" id="j_repay">—</div>
                                        </div>
                                        <div class="row">
                                            <div class="k">남은 대출</div>
                                            <div class="v" id="j_loanLeft">
                                                —
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="k">예금 운용금</div>
                                            <div class="v" id="j_cashLeft">
                                                —
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="k">
                                                월 예금이자(세전)
                                            </div>
                                            <div class="v" id="j_depInt_gross">
                                                —
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="k">월 이자소득세</div>
                                            <div class="v" id="j_depTax">—</div>
                                        </div>
                                        <div class="row">
                                            <div class="k">
                                                월 예금이자(세후)
                                            </div>
                                            <div class="v" id="j_depInt_net">
                                                —
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="k">월 대출이자</div>
                                            <div class="v" id="j_loanInt">
                                                —
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="k">월세 수입</div>
                                            <div class="v" id="j_rent">—</div>
                                        </div>
                                    </div>

                                    <div class="net">
                                        <div class="k">
                                            월 순현금흐름<br />
                                            <span class="tiny"
                                                >(세후 예금이자 − 대출이자 +
                                                월세)</span
                                            >
                                        </div>
                                        <div class="v" id="j_net">—</div>
                                    </div>
                                </div>
                            </div>

                            <div class="result-card">
                                <div class="inner">
                                    <div class="optionTitle">
                                        <div>
                                            <div class="title">월세</div>
                                            <div class="desc">
                                                월세 수입 반영
                                            </div>
                                        </div>
                                        <div class="badge" id="badgeWolse">
                                            —
                                        </div>
                                    </div>

                                    <div class="rows">
                                        <div class="row">
                                            <div class="k">대출 상환액</div>
                                            <div class="v" id="w_repay">—</div>
                                        </div>
                                        <div class="row">
                                            <div class="k">남은 대출</div>
                                            <div class="v" id="w_loanLeft">
                                                —
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="k">예금 운용금</div>
                                            <div class="v" id="w_cashLeft">
                                                —
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="k">
                                                월 예금이자(세전)
                                            </div>
                                            <div class="v" id="w_depInt_gross">
                                                —
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="k">월 이자소득세</div>
                                            <div class="v" id="w_depTax">—</div>
                                        </div>
                                        <div class="row">
                                            <div class="k">
                                                월 예금이자(세후)
                                            </div>
                                            <div class="v" id="w_depInt_net">
                                                —
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="k">월 대출이자</div>
                                            <div class="v" id="w_loanInt">
                                                —
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="k">월세 수입</div>
                                            <div class="v" id="w_rent">—</div>
                                        </div>
                                    </div>

                                    <div class="net">
                                        <div class="k">
                                            월 순현금흐름<br />
                                            <span class="tiny"
                                                >(세후 예금이자 − 대출이자 +
                                                월세)</span
                                            >
                                        </div>
                                        <div class="v" id="w_net">—</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="summary" id="summary">
                            입력값을 넣으면 어느 쪽이 월 기준으로 유리한지
                            요약해드립니다.
                        </div>

                        <footer>
                            <div class="tiny">
                                <b>계산식</b><br />
                                상환액 = min(받은금액, 대출금) · 남은대출 =
                                max(대출금 − 받은금액, 0) · 남는금액 =
                                max(받은금액 − 대출금, 0)<br />
                                월예금이자(세전) = 남는금액 × (예금금리/100) /
                                12 · 월이자소득세 = 세전이자 × 15.4%<br />
                                월대출이자 = 남은대출 × (대출금리/100) / 12 ·
                                월순현금흐름 = 세후예금이자 − 대출이자 + 월세
                            </div>
                        </footer>
                    </div>
                </section>
            </div>
        </div>

        <script>
            const STORAGE_KEY = "jeonse_wolse_landlord_calc_v3";

            // 이자소득세율 상수 (원천징수 14% + 지방소득세 1.4%)
            const INTEREST_TAX_RATE = 15.4;

            // helpers
            const fmt = new Intl.NumberFormat("ko-KR");
            const money = (n) => fmt.format(Math.round(n)) + "원";
            const signedMoney = (n) =>
                (n >= 0 ? "+" : "−") + money(Math.abs(n));
            const clamp0 = (x) => Math.max(0, x);

            function parseMoney(str) {
                if (!str) return 0;
                const cleaned = String(str).replace(/[^\d.-]/g, "");
                const n = Number(cleaned);
                return Number.isFinite(n) ? n : 0;
            }
            function formatMoneyInput(el) {
                const v = parseMoney(el.value);
                el.value = v ? fmt.format(Math.round(v)) : "";
            }

            // dom
            const el = {
                jeonseDeposit: document.getElementById("jeonseDeposit"),
                wolseDeposit: document.getElementById("wolseDeposit"),
                wolseRent: document.getElementById("wolseRent"),
                loanAmount: document.getElementById("loanAmount"),
                loanRate: document.getElementById("loanRate"),
                depositRate: document.getElementById("depositRate"),
                btnExample: document.getElementById("btnExample"),
                btnReset: document.getElementById("btnReset"),

                // jeonse outputs
                j_repay: document.getElementById("j_repay"),
                j_loanLeft: document.getElementById("j_loanLeft"),
                j_cashLeft: document.getElementById("j_cashLeft"),
                j_depInt_gross: document.getElementById("j_depInt_gross"),
                j_depTax: document.getElementById("j_depTax"),
                j_depInt_net: document.getElementById("j_depInt_net"),
                j_loanInt: document.getElementById("j_loanInt"),
                j_rent: document.getElementById("j_rent"),
                j_net: document.getElementById("j_net"),
                badgeJeonse: document.getElementById("badgeJeonse"),

                // wolse outputs
                w_repay: document.getElementById("w_repay"),
                w_loanLeft: document.getElementById("w_loanLeft"),
                w_cashLeft: document.getElementById("w_cashLeft"),
                w_depInt_gross: document.getElementById("w_depInt_gross"),
                w_depTax: document.getElementById("w_depTax"),
                w_depInt_net: document.getElementById("w_depInt_net"),
                w_loanInt: document.getElementById("w_loanInt"),
                w_rent: document.getElementById("w_rent"),
                w_net: document.getElementById("w_net"),
                badgeWolse: document.getElementById("badgeWolse"),

                summary: document.getElementById("summary"),
            };

            // persistence
            function saveToStorage() {
                const data = {
                    jeonseDeposit: parseMoney(el.jeonseDeposit.value),
                    wolseDeposit: parseMoney(el.wolseDeposit.value),
                    wolseRent: parseMoney(el.wolseRent.value),
                    loanAmount: parseMoney(el.loanAmount.value),
                    loanRate: el.loanRate.value ?? "",
                    depositRate: el.depositRate.value ?? "",
                };
                try {
                    localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
                } catch (e) {}
            }

            function loadFromStorage() {
                try {
                    const raw = localStorage.getItem(STORAGE_KEY);
                    if (!raw) return;
                    const data = JSON.parse(raw);

                    el.jeonseDeposit.value = data.jeonseDeposit
                        ? fmt.format(Math.round(data.jeonseDeposit))
                        : "";
                    el.wolseDeposit.value = data.wolseDeposit
                        ? fmt.format(Math.round(data.wolseDeposit))
                        : "";
                    el.wolseRent.value = data.wolseRent
                        ? fmt.format(Math.round(data.wolseRent))
                        : "";
                    el.loanAmount.value = data.loanAmount
                        ? fmt.format(Math.round(data.loanAmount))
                        : "";

                    el.loanRate.value = data.loanRate ?? "";
                    el.depositRate.value = data.depositRate ?? "";
                } catch (e) {}
            }

            // core calc
            function calcScenario(
                receivedDeposit,
                monthlyRentIncome,
                loanAmount,
                loanRatePct,
                depositRatePct,
            ) {
                const repay = Math.min(receivedDeposit, loanAmount);
                const loanLeft = clamp0(loanAmount - receivedDeposit);
                const cashLeft = clamp0(receivedDeposit - loanAmount);

                const loanRate = (loanRatePct || 0) / 100;
                const depRate = (depositRatePct || 0) / 100;
                const taxRate = INTEREST_TAX_RATE / 100;

                const depIntGross = (cashLeft * depRate) / 12;
                const depTax = depIntGross * taxRate;
                const depIntNet = depIntGross - depTax;

                const loanInt = (loanLeft * loanRate) / 12;
                const net = depIntNet - loanInt + (monthlyRentIncome || 0);

                return {
                    repay,
                    loanLeft,
                    cashLeft,
                    depIntGross,
                    depTax,
                    depIntNet,
                    loanInt,
                    monthlyRentIncome: monthlyRentIncome || 0,
                    net,
                };
            }

            function render() {
                const J = parseMoney(el.jeonseDeposit.value);
                const Wd = parseMoney(el.wolseDeposit.value);
                const Wr = parseMoney(el.wolseRent.value);
                const L = parseMoney(el.loanAmount.value);

                const loanRatePct = Number(el.loanRate.value || 0);
                const depRatePct = Number(el.depositRate.value || 0);

                const jeonse = calcScenario(J, 0, L, loanRatePct, depRatePct);
                const wolse = calcScenario(Wd, Wr, L, loanRatePct, depRatePct);

                // jeonse outputs
                el.j_repay.textContent = money(jeonse.repay);
                el.j_loanLeft.textContent = money(jeonse.loanLeft);
                el.j_cashLeft.textContent = money(jeonse.cashLeft);
                el.j_depInt_gross.textContent = signedMoney(jeonse.depIntGross);
                el.j_depTax.textContent = "−" + money(jeonse.depTax);
                el.j_depInt_net.textContent = signedMoney(jeonse.depIntNet);
                el.j_loanInt.textContent = "−" + money(jeonse.loanInt);
                el.j_rent.textContent = "+0원";
                el.j_net.textContent = signedMoney(jeonse.net);
                el.j_net.className = "v " + (jeonse.net >= 0 ? "good" : "bad");
                el.badgeJeonse.textContent =
                    jeonse.net >= 0 ? "월 순수익" : "월 순손실";

                // wolse outputs
                el.w_repay.textContent = money(wolse.repay);
                el.w_loanLeft.textContent = money(wolse.loanLeft);
                el.w_cashLeft.textContent = money(wolse.cashLeft);
                el.w_depInt_gross.textContent = signedMoney(wolse.depIntGross);
                el.w_depTax.textContent = "−" + money(wolse.depTax);
                el.w_depInt_net.textContent = signedMoney(wolse.depIntNet);
                el.w_loanInt.textContent = "−" + money(wolse.loanInt);
                el.w_rent.textContent = "+" + money(wolse.monthlyRentIncome);
                el.w_net.textContent = signedMoney(wolse.net);
                el.w_net.className = "v " + (wolse.net >= 0 ? "good" : "bad");
                el.badgeWolse.textContent =
                    wolse.net >= 0 ? "월 순수익" : "월 순손실";

                // summary
                const diff = jeonse.net - wolse.net;
                const diffAbs = money(Math.abs(diff));
                const best = diff > 0 ? "전세" : diff < 0 ? "월세" : "동일";
                const bestText =
                    best === "동일"
                        ? `두 옵션의 월 순현금흐름이 같습니다. (차이: 0원)`
                        : `<b>${best}</b>가 월 기준으로 더 유리합니다. (차이: <b>${diffAbs}</b>)`;

                const missing = [];
                if (!J) missing.push("전세금");
                if (!Wd) missing.push("월세 보증금");
                if (!Wr) missing.push("월세");
                if (!L) missing.push("대출금");
                if (!loanRatePct) missing.push("대출금리");
                if (!depRatePct) missing.push("예금금리");

                const missingText = missing.length
                    ? `<div class="muted" style="margin-top:8px">⚠ 입력 누락: ${missing.join(", ")} (0으로 간주)</div>`
                    : "";

                el.summary.innerHTML = `
                    <div>${bestText}</div>
                    <div class="muted" style="margin-top:6px">
                        전세: <b>${signedMoney(jeonse.net)}</b> · 월세: <b>${signedMoney(wolse.net)}</b>
                    </div>
                    <div class="muted">이자소득세율: <b>${INTEREST_TAX_RATE}%</b> (고정)</div>
                    ${missingText}
                `;

                saveToStorage();
            }

            // wiring
            const moneyInputs = [
                el.jeonseDeposit,
                el.wolseDeposit,
                el.wolseRent,
                el.loanAmount,
            ];
            moneyInputs.forEach((input) => {
                input.addEventListener("input", render);
                input.addEventListener("blur", () => {
                    formatMoneyInput(input);
                    render();
                });
                input.addEventListener("focus", () => input.select());
            });
            [el.loanRate, el.depositRate].forEach((input) => {
                input.addEventListener("input", render);
            });

            el.btnExample.addEventListener("click", () => {
                el.jeonseDeposit.value = "1,000,000,000";
                el.wolseDeposit.value = "100,000,000";
                el.wolseRent.value = "2,500,000";
                el.loanAmount.value = "300,000,000";
                el.loanRate.value = "4.2";
                el.depositRate.value = "3.2";
                render();
            });

            el.btnReset.addEventListener("click", () => {
                el.jeonseDeposit.value = "";
                el.wolseDeposit.value = "";
                el.wolseRent.value = "";
                el.loanAmount.value = "";
                el.loanRate.value = "";
                el.depositRate.value = "";
                try {
                    localStorage.removeItem(STORAGE_KEY);
                } catch (e) {}
                render();
            });

            // 기본값 설정
            const DEFAULT_VALUES = {
                jeonseDeposit: 650000000, // 6.5억
                wolseDeposit: 300000000, // 3억
                wolseRent: 1500000, // 150만원
                loanAmount: 250000000, // 2.5억
                loanRate: "4", // 4%
                depositRate: "3", // 3%
            };

            function applyDefaults() {
                el.jeonseDeposit.value = fmt.format(
                    DEFAULT_VALUES.jeonseDeposit,
                );
                el.wolseDeposit.value = fmt.format(DEFAULT_VALUES.wolseDeposit);
                el.wolseRent.value = fmt.format(DEFAULT_VALUES.wolseRent);
                el.loanAmount.value = fmt.format(DEFAULT_VALUES.loanAmount);
                el.loanRate.value = DEFAULT_VALUES.loanRate;
                el.depositRate.value = DEFAULT_VALUES.depositRate;
            }

            // 저장된 값이 없으면 기본값 적용
            const hasStoredData = localStorage.getItem(STORAGE_KEY);
            if (hasStoredData) {
                loadFromStorage();
            } else {
                applyDefaults();
            }
            render();
        </script>
    </body>
</html>
